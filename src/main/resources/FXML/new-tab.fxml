<?xml version="1.0" encoding="UTF-8"?>

<?import de.jensd.fx.glyphs.fontawesome.*?>
<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.*?>
<?import javafx.scene.text.*?>
<?import javafx.scene.web.*?>
<?import org.fxmisc.richtext.*?>

<BorderPane fx:id="main_browser" styleClass="to_top" stylesheets="@../CSS/dasboardMiniMark.css" xmlns="http://javafx.com/javafx/17.0.12" xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.example.prjbrowser.client.NewTabController">

    <!-- Toolbar -->
    <top>
        <VBox spacing="5">
            <padding>
                <Insets bottom="5" left="5" right="5" top="5" />
            </padding>

            <!-- Thanh Ä‘iá»u hÆ°á»›ng -->
            <HBox spacing="5">
                <Button fx:id="backBtn" onAction="#back">
                    <graphic>
                        <FontAwesomeIconView glyphName="BACKWARD" glyphSize="14" />
                    </graphic>
                </Button>
                <Button fx:id="forwardBtn" onAction="#forward">
                    <graphic>
                        <FontAwesomeIconView glyphName="FORWARD" glyphSize="14" />
                    </graphic>
                </Button>
                <Button fx:id="reloadBtn" onAction="#reload">
                    <graphic>
                        <FontAwesomeIconView glyphName="REFRESH" glyphSize="14" />
                    </graphic>
                </Button>
                <Button fx:id="toggleInspectButton">
                    <graphic>
                        <FontAwesomeIconView glyphName="COMMENTING" glyphSize="14" />
                    </graphic>
                </Button>
                <Button fx:id="homeBtn" onAction="#home">
                    <graphic>
                        <FontAwesomeIconView glyphName="HOME" glyphSize="14" />
                    </graphic>
                </Button>

                <!-- Ã” nháº­p URL -->
                <TextField fx:id="search" promptText="URL..." HBox.hgrow="ALWAYS" />

                <!-- NÃºt Ä‘Ã¡nh dáº¥u (â­) -->
                <Button fx:id="bookmarkBtn" onAction="#addBookmark">
                    <graphic>
                        <FontAwesomeIconView glyphName="STAR" glyphSize="16" />
                    </graphic>
                </Button>

                <!-- NÃºt menu -->
                <Button fx:id="menuBtn" onAction="#toggleMenu" text="â˜°" />
            </HBox>

            <!-- ðŸ†• Thanh nhÃ³m tháº» cÃ³ cuá»™n ngang -->
<!--            <ScrollPane fx:id="tabScrollPane"-->
<!--                        hbarPolicy="AS_NEEDED"-->
<!--                        vbarPolicy="NEVER"-->
<!--                        fitToHeight="true"-->
<!--                        style="-fx-background-color: transparent; -fx-border-color: transparent;">-->
<!--                <content>-->
                    <HBox fx:id="tabBar" spacing="3" style="-fx-background-color: #f3f3f3;                      -fx-padding: 2 3;                      -fx-min-height: 24;                      -fx-pref-height: 20;">
                        <!-- CÃ¡c nÃºt tháº» sáº½ Ä‘Æ°á»£c thÃªm Ä‘á»™ng báº±ng code -->
                        <Button style="-fx-background-color: transparent;                            -fx-font-weight: bold;                            -fx-font-size: 10px;                            -fx-padding: 0 4;" text="+" />
                    </HBox>
<!--                </content>-->
<!--            </ScrollPane>-->


            <!-- Thanh tiáº¿n trÃ¬nh táº£i -->
            <ProgressBar fx:id="progress" maxWidth="Infinity" prefHeight="8.0" />
        </VBox>
    </top>

    <!-- Center: WebView + slide menu + overlay -->
    <center>
        <StackPane fx:id="stackRoot">
            <!-- WebView chÃ­nh -->
            <!-- SplitPane chá»©a WebView vÃ  vÃ¹ng xem mÃ£ HTML -->
            <SplitPane fx:id="splitPane" dividerPositions="1.0" orientation="VERTICAL"> <!-- ban Ä‘áº§u WebView chiáº¿m háº¿t -->
                <!-- Pháº§n hiá»ƒn thá»‹ web -->
                <!-- âœ… LEFT panel váº«n tá»“n táº¡i nhÆ°ng sáº½ bá»‹ trÆ°á»£t áº©n báº±ng divider -->
                <SplitPane fx:id="splitPane_chilren" dividerPositions="0.5" orientation="HORIZONTAL"> <!-- ban Ä‘áº§u splitPane_chilren chiáº¿m háº¿t -->

                    <!-- LEFT PANEL (CHAT UI) -->
                    <BorderPane fx:id="leftPane">
                        <top>
                            <HBox spacing="10" style="-fx-background-color: #ececec; -fx-padding: 10;">
                                <Button fx:id="toggleMenuButton" style="-fx-font-size:18px; -fx-background-color: transparent;" text="â˜°" />
                                <Label fx:id="welcomeLabel" style="-fx-font-size:16px; -fx-font-weight:bold;" text="Welcome, User" />
                            </HBox>
                        </top>

                        <left>
                            <StackPane fx:id="leftBox" prefWidth="250">
                                <StackPane fx:id="menuContainer" prefWidth="250">
                                    <VBox fx:id="menuVBox" prefWidth="250" spacing="10" styleClass="to_top">
                                        <padding><Insets bottom="10" left="10" right="10" top="10" /></padding>

                                        <TextField fx:id="searchField" promptText="TÃ¬m há»™p thoáº¡i..." />

                                        <ScrollPane fitToWidth="true" prefHeight="450">
                                            <VBox fx:id="conversationListVBox" spacing="5">
                                                <padding><Insets bottom="5" left="5" right="5" top="5" /></padding>
                                            </VBox>
                                        </ScrollPane>

                                        <Button fx:id="newChatButton" onAction="#handleNewConversation" text="Táº¡o Chat Má»›i" />
                                    </VBox>
                                </StackPane>
                            </StackPane>
                        </left>

                        <center>
                            <StackPane fx:id="centerContainer">
                                <AnchorPane fx:id="centerAnchor">
                                    <VBox fx:id="centerVBox" prefWidth="650" spacing="10" AnchorPane.bottomAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0" AnchorPane.topAnchor="0">
                                        <padding><Insets bottom="10" left="10" right="10" top="10" /></padding>

                                        <ScrollPane fx:id="chatScrollPane"
                                                    fitToWidth="true" fitToHeight="true"
                                                    AnchorPane.topAnchor="0.0"
                                                    AnchorPane.leftAnchor="0.0"
                                                    AnchorPane.rightAnchor="0.0"
                                                    AnchorPane.bottomAnchor="0.0">
                                            <VBox fx:id="chatVBox" spacing="5">
                                                <padding><Insets bottom="5" left="5" right="5" top="5" /></padding>
                                            </VBox>
                                        </ScrollPane>
                                        <HBox spacing="10" style="-fx-padding: 10;">
                                            <TextField fx:id="messageField" promptText="Nháº­p tin nháº¯n..." HBox.hgrow="ALWAYS"/>
                                            <Button fx:id="sendButton" onAction="#handleSendMessage" text="Gá»­i"/>
                                        </HBox>
                                    </VBox>
                                </AnchorPane>
                            </StackPane>
                        </center>
                        <!-- âœ”ï¸ HBox input bar Ä‘Æ°a ra Ä‘Ã¢y -->
<!--                        <bottom>-->
<!--                            <HBox spacing="10" style="-fx-padding: 10;">-->
<!--                                <TextField fx:id="messageField" promptText="Nháº­p tin nháº¯n..." HBox.hgrow="ALWAYS"/>-->
<!--                                <Button fx:id="sendButton" onAction="#handleSendMessage" text="Gá»­i"/>-->
<!--                            </HBox>-->
<!--                        </bottom>-->
                    </BorderPane>


                    <WebView fx:id="webView"/>
                </SplitPane>

                <!-- Pháº§n xem mÃ£ nguá»“n HTML (áº©n ban Ä‘áº§u báº±ng kÃ­ch thÆ°á»›c) -->
                <AnchorPane fx:id="htmlInspector" style="-fx-background-color: white; -fx-border-color: #ccc; -fx-border-width: 1;">
                    <children>
                        <CodeArea fx:id="htmlCodeArea" editable="false" style="-fx-font-family: 'Consolas';                                  -fx-font-size: 13px;                                  -fx-background-color: #404040;                                  -fx-text-fill: #000000;" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0" />
                    </children>
                </AnchorPane>
            </SplitPane>

            <!-- Alert giá»¯a mÃ n hÃ¬nh -->
            <AnchorPane fx:id="browserAlert" style="-fx-background-color: rgb(255,148,114);                    -fx-background-radius: 10;                    -fx-padding: 14 24 14 24;                    -fx-effect: dropshadow(gaussian, rgba(255,140,0,0.5), 10, 0, 0, 3);                    -fx-max-width: 320;                    -fx-max-height: 120;" visible="false" StackPane.alignment="TOP_CENTER">
                <children>
                    <Label fx:id="alertMessage" alignment="CENTER" style="-fx-font-size: 14px;                       -fx-font-weight: bold;                       -fx-font-family: 'Segoe UI', sans-serif;                       -fx-wrap-text: true;                       -fx-text-alignment: center;" textFill="#ffffff" AnchorPane.bottomAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0" AnchorPane.topAnchor="0" />
                </children>
            </AnchorPane>



            <AnchorPane fx:id="mainBackground">
                <children>
                    <!-- Layer 1: áº¢nh ná»n responsive -->
                    <Region styleClass="background-layer" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0" />

                    <!-- Layer 2: Overlay gradient -->
                    <AnchorPane styleClass="overlay-gradient" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0" />
                    <!-- VBox chÃ­nh Ä‘á»ƒ cÄƒn dá»c cÃ¡c element, giÃ£n theo chiá»u ngang (anchored) -->
                    <VBox spacing="20.0" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0">
                        <children>
                            <!-- TiÃªu Ä‘á», chiáº¿m toÃ n chiá»u ngang, text cÄƒn giá»¯a -->
                            <Label alignment="CENTER" maxWidth="Infinity" text="Night Wolf" textFill="WHITE">
                                <font>
                                    <Font name="Algerian" size="40.0" />
                                </font>
                            </Label>

                            <!-- HBox chá»©a Time_label Ä‘á»ƒ cÄƒn giá»¯a theo chiá»u ngang,
                                 nhÆ°ng Time_label váº«n cÃ³ width cá»‘ Ä‘á»‹nh (khÃ´ng full width) -->
                            <HBox alignment="CENTER">
                                <children>
                                    <Label fx:id="Time_label" alignment="CENTER" prefHeight="40.0" prefWidth="254.0" text="00:00:00" textFill="WHITE">
                                        <font>
                                            <Font name="Script MT Bold" size="27.0" />
                                        </font>
                                    </Label>
                                </children>
                            </HBox>

                            <!-- Date label, chiáº¿m toÃ n chiá»u ngang, text cÄƒn giá»¯a -->
                            <Label fx:id="Date_label" alignment="CENTER" maxWidth="Infinity" text="DD/MM/yyyy" textFill="BLACK">
                                <font>
                                    <Font name="Script MT Bold" size="27.0" />
                                </font>
                            </Label>
                        </children>
                    </VBox>
                </children>
            </AnchorPane>

            <AnchorPane fx:id="historyBrowser" styleClass="to_top" visible="false">
                <children>
                    <!-- DÃ¹ng HBox Ä‘á»ƒ chá»©a 2 vÃ¹ng: bÃªn trÃ¡i (ná»™i dung chÃ­nh) + bÃªn pháº£i (nÃºt chá»©c nÄƒng) -->
                    <HBox spacing="10" style="-fx-padding: 10;" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0">

                        <!-- VÃ™NG CHÃNH: Lá»‹ch sá»­ trÃ¬nh duyá»‡t -->
                        <VBox fx:id="vboxHistory" spacing="10" styleClass="history-container" HBox.hgrow="ALWAYS">

                            <children>
                                <!-- Thanh tÃ¬m kiáº¿m -->
                                <HBox prefHeight="56.0" spacing="10">
                                    <children>
                                        <AnchorPane prefHeight="50.0" HBox.hgrow="ALWAYS">
                                            <children>
                                                <FontAwesomeIconView glyphName="SEARCH" layoutX="15.0" layoutY="28.0" size="20" styleClass="search-icon" />
                                                <TextField fx:id="searchBrowser" layoutX="45.0" layoutY="10.0" prefHeight="30.0" promptText="TÃ¬m kiáº¿m" styleClass="search" stylesheets="@../CSS/dasboardMiniMark.css" AnchorPane.leftAnchor="45.0" AnchorPane.rightAnchor="15.0" />
                                            </children>
                                        </AnchorPane>
                                    </children>
                                </HBox>

                                <!-- Báº£ng lá»‹ch sá»­ -->
                                <TableView fx:id="table_history_browser" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="time_col_table" text="NgÃ y / Giá»" />
                                        <TableColumn fx:id="url_col_table" text="ÄÆ°á»ng dáº«n" />
                                        <TableColumn fx:id="action_col_table" text="Hoáº¡t Ä‘á»™ng" />
                                    </columns>
                                </TableView>
                            </children>
                        </VBox>

                        <!-- VÃ™NG PHá»¤: CÃ¡c nÃºt chá»©c nÄƒng -->
                        <VBox fx:id="vboxButtons" alignment="TOP_CENTER" prefWidth="120.0" spacing="10" style="-fx-background-color: #f4f4f4; -fx-padding: 10; -fx-border-color: #ddd; -fx-border-radius: 8;">
                            <children>
                                <Button fx:id="btnRefresh" onAction="#refreshHistory" prefWidth="100.0" text="LÃ m má»›i" />
                                <Button fx:id="btnDelete" onAction="#deleteSelectedHistory" prefWidth="100.0" text="XoÃ¡ lá»‹ch sá»­" />
                                <Button fx:id="btnClose" onAction="#home" prefWidth="100.0" text="ÄÃ³ng" />
                            </children>
                        </VBox>

                    </HBox>
                </children>
            </AnchorPane>




            <!-- Overlay má» -->
            <AnchorPane fx:id="overlay" pickOnBounds="true" style="-fx-background-color: rgba(0,0,0,0.4);" visible="false" />

            <AnchorPane fx:id="slideMenu" prefWidth="200" styleClass="slideMenu">

                <AnchorPane prefHeight="575.0" prefWidth="374.0">
                    <children>
                        <!-- Avatar + buttons -->
                        <StackPane layoutX="32.0" layoutY="20" prefHeight="150" prefWidth="127.0" styleClass="avatar-pane">
                            <!-- Avatar hÃ¬nh trÃ²n -->
                            <ImageView fx:id="image_browser" fitHeight="120" fitWidth="120" pickOnBounds="true" preserveRatio="true" styleClass="avatar-image">
                                <image>
                                    <Image url="@../Image/user.png" />
                                </image>
                                <clip>
                                    <Circle centerX="60" centerY="60" radius="60" />
                                </clip>
                            </ImageView>

                            <!-- NÃºt Save (gÃ³c trÃ¡i, ná»­a trong ná»­a ngoÃ i) -->
                            <Button fx:id="btnSaveImage" onAction="#handleSaveImage" styleClass="avatar-button" text="" translateX="-5" translateY="5" StackPane.alignment="BOTTOM_LEFT">
                                <graphic>
                                    <FontAwesomeIconView glyphName="SAVE" size="16" />
                                </graphic>
                            </Button>

                            <!-- NÃºt Select (gÃ³c pháº£i, ná»­a trong ná»­a ngoÃ i) -->
                            <Button fx:id="btnSelectImage" onAction="#handleSelectImage" styleClass="avatar-button" text="" translateX="5" translateY="5" StackPane.alignment="BOTTOM_RIGHT">
                                <graphic>
                                    <FontAwesomeIconView glyphName="PENCIL" size="16" />
                                </graphic>
                            </Button>
                        </StackPane>


                        <!-- VBox chá»©a thÃ´ng tin ngÆ°á»i dÃ¹ng -->
                        <VBox layoutX="22.0" layoutY="190.0" prefHeight="427.0" prefWidth="342.0" spacing="10">

                            <HBox prefHeight="37.0" prefWidth="342.0">
                                <children>
                                    <Label fx:id="username_browser" alignment="CENTER_LEFT" maxWidth="Infinity" prefHeight="35.0" prefWidth="207.0" text="Label">
                                        <font>
                                            <Font name="Tahoma" size="24.0" />
                                        </font>
                                    </Label>
                                </children>
                            </HBox>

                            <AnchorPane prefHeight="28.0" prefWidth="342.0">
                                <children>
                                    <Button fx:id="Logout" alignment="CENTER_LEFT" maxWidth="Infinity" onAction="#Login_Logout" prefHeight="27.0" prefWidth="342.0" styleClass="nutnhan" text="ÄÄƒng xuáº¥t" />
                                    <Button fx:id="Login" alignment="CENTER_LEFT" maxWidth="Infinity" onAction="#Login_Logout" prefHeight="27.0" prefWidth="342.0" styleClass="nutnhan" text="ÄÄƒng nháº­p" />
                                </children>
                            </AnchorPane>

                            <Button fx:id="list_History" alignment="CENTER_LEFT" maxWidth="Infinity" onAction="#list_History" styleClass="nutnhan" text="Xem lá»‹ch sá»­" />

                        </VBox>

                    </children>
                </AnchorPane>

            </AnchorPane>
        </StackPane>
    </center>
</BorderPane>
